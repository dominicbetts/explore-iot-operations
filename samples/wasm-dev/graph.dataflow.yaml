
  moduleRequirements:
    apiVersion: "0.2.0"
    hostlibVersion: "0.2.0"
    features: # options: wasi-nn, no values required
      - name: "wasi-nn"
  moduleConfigurations:
    - name: module-snapshot/branch
      parameters:
        snapshot_topic:
          name: snapshot_topic
          description: Transform app snapshot_topic in snapshot branch's init routine
          default: snapshot_simulation
    - name: module-temperature/filter
      parameters:
        temperature_lower_bound:
          name: temperature_lower_bound
          description: Defines the lower bound for valid temperature values
          default: -273.15
        temperature_upper_bound:
          name: temperature_upper_bound
          description: Defines the upper bound for valid temperature values
          default: 5000.0
  operations:
    - operationType: "source"
      name: "source"

    - operationType: "delay"
      name: "module-window/delay"
      module: "window"

    - operationType: "map"
      name: "module-format/map"
      module: "format"

    - operationType: "map"
      name: "module-snapshot/map"
      module: "snapshot"

    - operationType: "branch"
      name: "module-snapshot/branch"
      module: "snapshot"

    - operationType: "accumulate"
      name: "module-snapshot/accumulate"
      module: "snapshot"

    - operationType: "map"
      name: "module-temperature/map"
      module: "temperature"

    - operationType: "branch"
      name: "module-temperature/branch"
      module: "temperature"

    - operationType: "filter"
      name: "module-temperature/filter"
      module: "temperature"

    - operationType: "accumulate"
      name: "module-temperature/accumulate"
      module: "temperature"

    - operationType: "accumulate"
      name: "module-humidity/accumulate"
      module: "humidity"

    - operationType: "concatenate"
      name: "concatenate1"

    - operationType: "accumulate"
      name: "module-collection/accumulate"
      module: "collection"

    - operationType: "map"
      name: "module-enrichment/map"
      module: "enrichment"

    - operationType: "sink"
      name: "sink"


#                              +--------+
#                              | source |
#                              +--------+
#                                  |
#                                  v
#                      +-----------------------+
#                      |  module-window/delay  |
#                      +-----------------------+
#                                  |
#                                  v
#        +-----------------------------------------------------+
#        |               module-snapshot/branch                |--------------------------|
#        +-----------------------------------------------------+                          |
#                    |                                                                    |
#                    v                                                                    v
#              (sensor data)                                                          (snapshot)
#                    |                                                                    |
#                    v                                                                    v
#        +-----------------------------------------------------+            +----------------------------+
#        |              module-temperature/branch              |            |      module-format/map     |
#        +-----------------------------------------------------+            |       (image format)       |
#                |                                     |                    +----------------------------+
#             (temp)                              (humidity)                              |
#                |                                     |                                  v
#                v                                     |                    +----------------------------+
#  +-------------------------------+                   |                    |     module-snapshot/map    |
#  |    module-temperature/map     |                   |                    |     (object detection)      |
#  |          (F -> C)             |                   |                    +----------------------------+
#  +-------------------------------+                   v                                  |
#                |                       +----------------------------+                   v
#                v                       | module-humidity/accumulate |     +----------------------------+
#  +-------------------------------+     |   (max, min, avg, last)    |     | module-snapshot/accumulate |
#  |   module-temperature/filter   |     +----------------------------+     |        (collection)        |
#  |          (valid)              |                   |                    +----------------------------+
#  +-------------------------------+                   |                                  |
#                |                                     |                                  |
#                v                                     |                                  |
#  +-------------------------------+                   |                                  |
#  | module-temperature/accumulate |                   |                                  |
#  |    (max, min, avg, last)      |                   |                                  |
#  +-------------------------------+                   |                                  |
#                |                                     |                                  |
#                v                                     v                                  |
#        +-----------------------------------------------------+                          |
#        |                    concatenate                      |<-------------------------|
#        +-----------------------------------------------------+
#                                  |
#                                  v
#                   +------------------------------+
#                   | module-collection/accumulate |
#                   +------------------------------+
#                                  |
#                                  v
#                   +------------------------------+
#                   |     module-enrichment/map    |
#                   |       (overtemp, topic)      |
#                   +------------------------------+
#                                  |
#                                  v
#                              +------+
#                              | sink |
#                              +------+
  connections:
    - from:
        name: "source"
      to:
        name: "module-window/delay"

    - from:
        name: "module-window/delay"
      to:
        name: "module-snapshot/branch"

    - from:
        name: "module-snapshot/branch"
        arm: "False"
      to:
        name: "module-temperature/branch"

    - from:
        name: "module-snapshot/branch"
        arm: "True"
      to:
        name: "module-format/map"

    - from:
        name: "module-format/map"
      to:
        name: "module-snapshot/map"

    - from:
        name: "module-snapshot/map"
      to:
        name: "module-snapshot/accumulate"

    - from:
        name: "module-snapshot/accumulate"
      to:
        name: "concatenate1"

    - from:
        name: "module-temperature/branch"
        arm: "True"
      to:
        name: "module-temperature/map"

    - from:
        name: "module-temperature/branch"
        arm: "False"
      to:
        name: "module-humidity/accumulate"

    - from:
        name: "module-humidity/accumulate"
      to:
        name: "concatenate1"

    - from:
        name: "module-temperature/map"
      to:
        name: "module-temperature/filter"

    - from:
        name: "module-temperature/filter"
      to:
        name: "module-temperature/accumulate"

    - from:
        name: "module-temperature/accumulate"
      to:
        name: "concatenate1"

    - from:
        name: "concatenate1"
      to:
        name: "module-collection/accumulate"

    - from:
        name: "module-collection/accumulate"
      to:
        name: "module-enrichment/map"

    - from:
        name: "module-enrichment/map"
      to:
        name: "sink"
